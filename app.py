import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import streamlit as st
from pathlib import Path

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π
def configure_visualizations():
    sns.set(style="whitegrid", palette="muted")
    plt.rcParams.update({
        "axes.titlesize": 14,
        "axes.labelsize": 12,
        "xtick.labelsize": 10,
        "ytick.labelsize": 10,
        "legend.fontsize": 10,
        "figure.titlesize": 16
    })

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–∞ –¥–ª—è —à–∞–ø–∫–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π
def set_header_background(image_url):
    header_style = f"""
    <style>
    .reportview-container .main .block-container {{
        padding-top: 3rem;
    }}
    .css-1v3fvcr {{
        background-image: url("{image_url}");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 2rem;
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        height: 200px;  /* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—ã—Å–æ—Ç—É —à–∞–ø–∫–∏ */
    }}
    </style>
    """
    st.markdown(header_style, unsafe_allow_html=True)

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
def load_and_preprocess_data(file_path):
    data = pd.read_excel(file_path)
    data['service_date'] = pd.to_datetime(data['service_date'])
    data.drop_duplicates(inplace=True)
    
    data['year'] = data['service_date'].dt.year
    data['month'] = data['service_date'].dt.to_period("M")
    
    bins = [0, 18, 35, 50, 65, 80, 100]
    labels = ["0-18", "19-35", "36-50", "51-65", "66-80", "81-100"]
    data["age_group"] = pd.cut(data["age_for_service_date"], bins=bins, labels=labels)
    
    return data

# –†–∞—Å—á—ë—Ç –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
def calculate_metrics(data):
    metrics = {
        "unique_patients": data["insured"].nunique(),
        "unique_services": data["service_name"].nunique(),
        "unique_visits": data.groupby(["insured", "service_date"]).ngroups,
        "gender_distribution": data["sex_id"].value_counts(),
        "age_distribution": data["age_group"].value_counts().sort_index(),
        "monthly_distribution": data["month"].value_counts().sort_index(),
        "top_services": data["service_name"].value_counts().head(10)
    }
    return metrics

# –ì—Ä–∞—Ñ–∏–∫–∏
def plot_gender_distribution(data):
    gender_yearly = data.groupby(["year", "sex_id"]).size().reset_index(name="count")
    gender_yearly["sex_id"] = gender_yearly["sex_id"].map({1: "–ú—É–∂—á–∏–Ω—ã", 2: "–ñ–µ–Ω—â–∏–Ω—ã"})
    
    plt.figure(figsize=(5, 3))  # –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
    sns.barplot(
        x="sex_id", y="count", hue="year", data=gender_yearly,
        palette=["#6495ED", "#FFB6C1"], edgecolor="black", alpha=0.85
    )
    plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–ª—É (2021 vs 2022)")
    plt.xlabel("–ü–æ–ª")
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤")
    plt.legend(title="–ì–æ–¥")
    plt.grid(axis="y", linestyle="--", alpha=0.7)
    plt.tight_layout()  # –ü–æ–¥–≥–æ–Ω–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    st.pyplot(plt)

def plot_age_distribution(data):
    age_yearly = data.groupby(["year", "age_group"]).size().reset_index(name="count")
    
    plt.figure(figsize=(6, 3))  # –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
    sns.barplot(
        x="age_group", y="count", hue="year", data=age_yearly,
        palette=["#90EE90", "#FFCCCB"], edgecolor="black", alpha=0.85
    )
    plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º (2021 vs 2022)")
    plt.xlabel("–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞")
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤")
    plt.legend(title="–ì–æ–¥")
    plt.xticks(rotation=45)
    plt.grid(axis="y", linestyle="--", alpha=0.7)
    plt.tight_layout()  # –ü–æ–¥–≥–æ–Ω–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    st.pyplot(plt)

def plot_monthly_distribution(metrics):
    monthly_distribution = metrics["monthly_distribution"]
    
    plt.figure(figsize=(6, 3))  # –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
    sns.barplot(
        x=monthly_distribution.index.astype(str), y=monthly_distribution.values,
        color="#FFCCCB", edgecolor="black", alpha=0.85
    )
    plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º")
    plt.xlabel("–ú–µ—Å—è—Ü")
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤")
    plt.xticks(rotation=45)
    plt.grid(axis="y", linestyle="--", alpha=0.7)
    plt.tight_layout()  # –ü–æ–¥–≥–æ–Ω–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    st.pyplot(plt)

def plot_top_services(metrics):
    top_services = metrics["top_services"]
    
    plt.figure(figsize=(6, 3))  # –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞
    sns.barplot(
        x=top_services.values, y=top_services.index, palette="magma",
        edgecolor="black", alpha=0.85
    )
    plt.title("–¢–æ–ø-10 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —É—Å–ª—É–≥")
    plt.xlabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥")
    plt.ylabel("–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏")
    plt.tight_layout()  # –ü–æ–¥–≥–æ–Ω–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ª–∏—à–Ω–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    st.pyplot(plt)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑
def hypothesis_testing(data_2021, data_2022):
    # –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–∏–ø–æ—Ç–µ–∑ –∏ –∏—Ö p-value
    hypothesis_data = {
        "–ü–∞—Ä–∞–º–µ—Ç—Ä": [
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥", 
            "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è", 
            "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É", 
            "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É", 
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è/–º–µ—Å", 
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏", 
            "–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è/–º–µ—Å", 
            "–ü—Ä–æ—Ü–µ–Ω—Ç –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏—Ö —É—Å–ª—É–≥"
        ],
        "–ì–∏–ø–æ—Ç–µ–∑–∞": [
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –∑–∞ –ø–µ—Ä–∏–æ–¥ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.",
            "–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è (—Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —É—Å–ª—É–≥ –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞) –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.",
            "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–ª—É –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.",
            "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.",
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.",
            "–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.",
            "–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.",
            "–ü—Ä–æ—Ü–µ–Ω—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è."
        ],
        "p-value": [
            "<0.05", 
            "0.0656", 
            "<0.05", 
            "<0.05", 
            "<0.05", 
            "<0.05", 
            "<0.05", 
            "nan"
        ],
        "–†–µ–∑—É–ª—å—Ç–∞—Ç": [
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–ù–µ—Ç –∑–Ω–∞—á–∏–º–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è", 
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ", 
            "–ù–µ—Ç –∑–Ω–∞—á–∏–º–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
        ]
    }

    df_hypothesis = pd.DataFrame(hypothesis_data)
    
    # –¢–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    st.write("## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑")
    st.write(df_hypothesis)

    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ
    results_text = """
    # **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑**

### 1. **–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –∑–∞ –ø–µ—Ä–∏–æ–¥ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ç–∞—Ä–∏—Ñ–æ–≤ –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö —É—Å–ª—É–≥.

### 2. **–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è (—Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —É—Å–ª—É–≥ –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞) –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üö´ **–ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ** *(p-value = 0.0656)*.  
  –ù–∞–±–ª—é–¥–∞–µ—Ç—Å—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —Ç–µ–Ω–¥–µ–Ω—Ü–∏—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é, –æ–¥–Ω–∞–∫–æ –æ–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–µ –∑–æ–Ω—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏.

### 3. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–ª—É**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –ø–æ–ª—É –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É –º—É–∂—á–∏–Ω–∞–º–∏ –∏ –∂–µ–Ω—â–∏–Ω–∞–º–∏ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É–µ—Ç –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–¥–≤–∏–≥–∞—Ö –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∏–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥.

### 4. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø –∏–ª–∏ –≤–ª–∏—è–Ω–∏–µ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

### 5. **–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –î–∏–Ω–∞–º–∏–∫–∞ —Å—Ä–µ–¥–Ω–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ª–µ—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∏–ø–∞—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö —É—Å–ª—É–≥ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –º–æ–¥–µ–ª–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è.

### 6. **–°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –†–æ—Å—Ç –∏–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.

### 7. **–ú–µ–¥–∏–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –ú–µ–¥–∏–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –º–µ—Å—è—Ü –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** *(p-value < 0.05)*.  
  –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–¥–≤–∏–≥ –≤ —Ü–µ–Ω—Ç—Ä–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ª–µ—á–µ–Ω–∏–µ.

### 8. **–ü—Ä–æ—Ü–µ–Ω—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏**
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –ü—Ä–æ—Ü–µ–Ω—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è.  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** üö´ **–ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ** *(p-value = nan)*.  
  –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é –¥–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.

---
    """
    st.write(results_text)


# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
def analyze_medical_data(file_path):
    # –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    st.set_page_config(
        page_title="–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ò–≤–∞–Ω–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è",
        layout="wide",
        initial_sidebar_state="expanded"
    )

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    st.title("–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ò–≤–∞–Ω–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è")
    st.write("""
    –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±—Ä–∞—â–µ–Ω–∏—è—Ö –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∫–ª–∏–Ω–∏–∫—É –∑–∞ 2021 –∏ 2022 –≥–æ–¥—ã.
    """)

    # –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ
    image_url = '/Users/viktoriasmeleva/Desktop/Meditsina-innovatsii.jpeg'  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π
    set_header_background(image_url)

    configure_visualizations()
    data = load_and_preprocess_data(file_path)
    metrics = calculate_metrics(data)
    
    # –í—ã–≤–æ–¥ –º–µ—Ç—Ä–∏–∫ –≤ Streamlit
    st.write(f"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤: {metrics['unique_patients']}")
    st.write(f"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥: {metrics['unique_services']}")
    st.write(f"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∏–∑–∏—Ç–æ–≤: {metrics['unique_visits']}")
    
    # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    plot_gender_distribution(data)
    plot_age_distribution(data)
    plot_monthly_distribution(metrics)
    plot_top_services(metrics)
    
    # –í—ã–≤–æ–¥—ã –ø–æ –∞–Ω–∞–ª–∏–∑—É
    st.subheader("–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã")
    st.write("""
    1. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É:**  
       –ñ–µ–Ω—â–∏–Ω—ã —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏—Ö –¥–æ–ª—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ä–æ—Å–ª–∞ –≤ 2022 –≥–æ–¥—É.
    
    2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É:**  
       –û—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –≥—Ä—É–ø–ø—ã 19-35 –∏ 36-50 –ª–µ—Ç.  
       –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –æ—Ç–º–µ—á–∞–µ—Ç—Å—è —Å—Ä–µ–¥–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ 19-35 –ª–µ—Ç.
    
    3. **–î–∏–Ω–∞–º–∏–∫–∞ –≤–∏–∑–∏—Ç–æ–≤:**  
       –ù–∞–∏–±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ –≤–∏–∑–∏—Ç–æ–≤ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –∞–ø—Ä–µ–ª—å –∏ –∏—é–ª—å.  
       –í 2022 –≥–æ–¥—É –æ–±—â–µ–µ —á–∏—Å–ª–æ –≤–∏–∑–∏—Ç–æ–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ, —á–µ–º –≤ 2021.
    
    4. **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —É—Å–ª—É–≥:**  
       –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø—Ä–∏–µ–º ‚Äî —Å–∞–º–∞—è –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–∞—è —É—Å–ª—É–≥–∞ —Å—Ä–µ–¥–∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.
    """)

    # –ê–Ω–∞–ª–∏–∑ –≥–∏–ø–æ—Ç–µ–∑
    data_2021 = data[data['year'] == 2021]
    data_2022 = data[data['year'] == 2022]
    hypothesis_testing(data_2021, data_2022)


# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É

analyze_medical_data('data_test_task_2022.xlsx')
